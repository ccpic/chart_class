# 颜色管理编辑功能说明

## ✨ 新增功能

颜色管理组件现在支持完整的 CRUD 操作：

### 1. **查看颜色列表** ✅
- 显示所有颜色映射
- 实时搜索和分类筛选
- 颜色预览和详细信息

### 2. **添加新颜色** 🆕
点击"添加新颜色"按钮，填写表单：
- **颜色名称** *（必填）- 唯一标识符
- **颜色值** *（必填）- 支持颜色选择器和手动输入
- **分类**（可选）- 支持现有分类自动完成
- **描述**（可选）- 颜色用途说明
- 实时预览效果

### 3. **编辑现有颜色** 🆕
点击颜色条目右侧的"编辑"图标：
- 颜色名称不可修改（只读）
- 可修改颜色值、分类、描述
- 实时预览更新效果

### 4. **删除颜色** ✅
点击"删除"图标：
- 显示确认对话框
- 防止误删除
- 删除后自动刷新列表

---

## 🎯 使用方法

### 添加新颜色

```
1. 点击侧边栏"颜色管理"
2. 点击"添加新颜色"按钮
3. 填写表单：
   - 名称: "测试红色"
   - 颜色值: #FF0000 (或使用颜色选择器)
   - 分类: "测试"
   - 描述: "用于测试的红色"
4. 查看预览
5. 点击"添加"
```

### 编辑颜色

```
1. 在颜色列表中找到要编辑的颜色
2. 点击右侧的"编辑"图标（铅笔图标）
3. 修改颜色值、分类或描述
4. 查看预览
5. 点击"保存"
```

### 删除颜色

```
1. 在颜色列表中找到要删除的颜色
2. 点击右侧的"删除"图标（垃圾桶图标）
3. 在确认对话框中点击"删除"
```

---

## 🔧 技术实现

### 对话框组件
- **编辑对话框**: `Dialog` - 用于新增和编辑表单
- **删除确认**: `AlertDialog` - 防止误删除

### 表单功能
```tsx
// 表单数据状态
const [formData, setFormData] = useState({
  name: '',
  color: '#000000',
  category: '',
  description: '',
});

// 区分新增/编辑模式
const [isNewColor, setIsNewColor] = useState(false);
```

### API 调用
```tsx
// 新增颜色
await colorAPI.createColor({
  name: formData.name,
  color: formData.color,
  category: formData.category || undefined,
  description: formData.description || undefined,
  overwrite: false,
});

// 更新颜色
await colorAPI.updateColor(colorName, {
  color: formData.color,
  category: formData.category || undefined,
  description: formData.description || undefined,
});

// 删除颜色
await colorAPI.deleteColor(colorName);
```

---

## 🎨 UI 特性

### 颜色选择器
- 原生 HTML5 颜色选择器
- 手动输入十六进制颜色值
- 实时同步

### 分类自动完成
- 使用 `<datalist>` 实现
- 显示现有分类建议
- 支持自定义新分类

### 实时预览
- 在保存前查看颜色效果
- 显示完整的颜色信息
- 大尺寸预览块

### 验证
- 必填字段检查（名称、颜色值）
- 颜色格式验证
- 错误提示

---

## 📝 示例操作

### 示例 1: 添加品牌主色
```
名称: 品牌蓝
颜色值: #0066CC
分类: 品牌
描述: 公司品牌主色调
```

### 示例 2: 编辑现有颜色
```
找到"心血管销售事业部"
修改颜色值: #00BFFF -> #1E90FF
更新分类: -> "部门"
```

### 示例 3: 批量管理
```
1. 使用搜索功能找到相关颜色
2. 逐个编辑或删除
3. 添加新的替代颜色
```

---

## ⚠️ 注意事项

1. **名称唯一性**: 新增时颜色名称必须唯一
2. **编辑限制**: 编辑时无法修改颜色名称（防止引用失效）
3. **删除影响**: 删除颜色可能影响使用该颜色的图表
4. **持久化**: 所有更改立即保存到 `data/color_dict.json`

---

## 🐛 故障排查

### 问题：保存失败
- 检查颜色名称是否重复
- 验证颜色值格式（需要 # 前缀）
- 查看浏览器控制台错误信息

### 问题：编辑按钮无响应
- 确保 Web API 服务正在运行
- 检查网络连接（开发者工具 Network 面板）
- 验证 API 端点是否正确

### 问题：删除后仍显示
- 刷新页面
- 检查 API 返回状态
- 验证 `data/color_dict.json` 文件权限

---

## 🚀 后续优化

- [ ] 批量导入/导出功能
- [ ] 颜色历史记录
- [ ] 撤销/重做操作
- [ ] 颜色分组管理
- [ ] 拖拽排序
- [ ] 颜色主题预设
